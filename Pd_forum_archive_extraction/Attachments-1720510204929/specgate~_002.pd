#N canvas 179 293 942 569 10;
#N canvas 583 163 787 690 calctilt 0;
#X obj 68 7 r \$0-tilt;
#X obj 132 487 *~;
#X obj 281 349 r \$0-thrshld;
#X obj 35 58 - 0.5;
#X obj 134 576 tabwrite~ \$0-tiltray;
#X obj 86 541 bng 15 250 50 0 empty empty empty 0 -6 0 8 -262144 -1
-1;
#X msg 161 88 0;
#X obj 227 31 samplerate~;
#X obj 227 8 loadbang;
#X obj 336 3 bng 15 250 50 0 empty empty empty 0 -6 0 8 -262144 -1
-1;
#X obj 81 32 t b f b;
#X obj 151 513 +~;
#X obj 226 465 t b b f;
#X obj 102 236 *~ 2;
#X obj 102 259 -~ 1;
#X obj 109 311 *~;
#X obj 139 275 *~ 8.38861e+06;
#X obj 139 295 clip~ -1 1;
#X obj 102 205 phasor~;
#X obj 230 55 / 512;
#X obj 349 423 * 127;
#X obj 120 404 *~ 127;
#X obj 147 540 clip~ 0 127;
#X obj 97 83 * 2;
#X connect 0 0 10 0;
#X connect 1 0 11 0;
#X connect 2 0 20 0;
#X connect 3 0 23 0;
#X connect 5 0 4 0;
#X connect 6 0 18 1;
#X connect 7 0 19 0;
#X connect 8 0 7 0;
#X connect 9 0 7 0;
#X connect 10 0 5 0;
#X connect 10 1 3 0;
#X connect 10 2 6 0;
#X connect 11 0 22 0;
#X connect 12 0 4 0;
#X connect 12 1 6 0;
#X connect 12 2 11 1;
#X connect 13 0 14 0;
#X connect 14 0 15 0;
#X connect 14 0 16 0;
#X connect 15 0 21 0;
#X connect 16 0 17 0;
#X connect 17 0 15 1;
#X connect 18 0 13 0;
#X connect 19 0 18 0;
#X connect 20 0 12 0;
#X connect 21 0 1 0;
#X connect 22 0 4 0;
#X connect 23 0 1 1;
#X restore 371 109 pd calctilt;
#N canvas 518 94 871 773 1024-fftanalysis 1;
#X obj 111 49 inlet~;
#X obj 110 133 rfft~;
#X obj 101 554 rifft~;
#X obj 152 696 outlet~;
#X obj 207 179 *~;
#X obj 242 182 *~;
#X obj 108 465 *~;
#X obj 168 451 *~;
#X text 372 248 calculate amplitudes;
#X obj 208 209 +~ 1e-20;
#X text 295 210 protect against divide-by-zero;
#X text 585 294 only let amps > x pass;
#X obj 137 85 tabreceive~ \$0-hann;
#X obj 112 107 *~;
#X obj 306 106 block~ 512 4;
#X obj 177 637 tabreceive~ \$0-hann;
#X obj 152 659 *~;
#X text 199 573 divide by 3N/2 (factor of N because rfft and rifft
aren't normalized \, and 3/2 is the gain of overlap-4 reconstruction
when Hann window function is applied twice.);
#X obj 101 624 /~ 768;
#X obj 209 291 /~ 768;
#X text 288 295 normalize;
#X obj 208 240 q8_sqrt~;
#X obj 283 423 vectral~;
#X obj 492 382 loadbang;
#X obj 417 335 tabreceive~ \$0-sync;
#N canvas 0 22 462 312 gettilt 0;
#X obj 234 268 outlet~;
#X obj 304 40 block~ 512 0;
#X obj 263 98 tabreceive~ \$0-tiltray;
#X text 91 36 so there's no overlap for tilt;
#X text 91 45 we just want the straight data;
#X connect 2 0 0 0;
#X restore 324 327 pd gettilt;
#X obj 274 373 >~;
#X obj 632 456 pack 0 0;
#X obj 392 384 r \$0-maxamp;
#X obj 384 419 r \$0-minamp;
#X obj 386 469 clip~;
#X obj 598 333 r \$0-attackbins;
#X obj 678 357 r \$0-releasebins;
#X obj 675 399 int;
#X obj 677 422 t b f;
#X obj 618 405 int;
#X msg 494 445 rampsmooth \$1 \$2;
#X obj 325 353 dbtorms~;
#X connect 0 0 13 0;
#X connect 1 0 6 0;
#X connect 1 0 4 0;
#X connect 1 0 4 1;
#X connect 1 1 7 0;
#X connect 1 1 5 0;
#X connect 1 1 5 1;
#X connect 2 0 18 0;
#X connect 4 0 9 0;
#X connect 5 0 9 0;
#X connect 6 0 2 0;
#X connect 7 0 2 1;
#X connect 9 0 21 0;
#X connect 12 0 13 1;
#X connect 13 0 1 0;
#X connect 15 0 16 1;
#X connect 16 0 3 0;
#X connect 18 0 16 0;
#X connect 19 0 26 0;
#X connect 21 0 19 0;
#X connect 22 0 7 1;
#X connect 22 0 6 1;
#X connect 24 0 22 0;
#X connect 24 0 22 1;
#X connect 25 0 37 0;
#X connect 26 0 30 0;
#X connect 27 0 36 0;
#X connect 28 0 30 2;
#X connect 29 0 30 1;
#X connect 30 0 22 2;
#X connect 31 0 35 0;
#X connect 32 0 33 0;
#X connect 33 0 34 0;
#X connect 34 0 35 0;
#X connect 34 1 27 1;
#X connect 35 0 27 0;
#X connect 36 0 22 0;
#X connect 37 0 26 1;
#X restore 373 155 pd \$0-fftanalysis;
#N canvas 35 66 600 441 Hann-window 0;
#N canvas 0 22 450 300 (subpatch) 0;
#X array \$0-hann 512 float 0;
#X coords 0 1 511 0 200 120 1;
#X restore 293 249 graph;
#X msg 171 263 0;
#X obj 65 312 osc~;
#X obj 65 264 samplerate~;
#X obj 65 335 *~ -0.5;
#X obj 65 358 +~ 0.5;
#X obj 57 383 tabwrite~ \$0-hann;
#X text 279 241 1;
#X text 272 359 0;
#X text 288 372 0;
#X obj 65 288 / 512;
#X obj 57 241 bng 15 250 50 0 empty empty empty 0 -6 0 8 -262144 -1
-1;
#X text 336 221 Hann window;
#X text 113 310 period 512;
#X text 90 215 recalculate Hann;
#X text 125 230 window table;
#X obj 57 146 loadbang;
#X msg 79 179 \; pd dsp 1;
#X text 40 27 The Hann window is now recomputed on 'loadbang' to make
the file smaller (it doesn't have to be saved with the array.);
#X text 474 375 511;
#X connect 1 0 2 1;
#X connect 2 0 4 0;
#X connect 3 0 10 0;
#X connect 4 0 5 0;
#X connect 5 0 6 0;
#X connect 10 0 2 0;
#X connect 11 0 3 0;
#X connect 11 0 1 0;
#X connect 11 0 6 0;
#X connect 16 0 11 0;
#X connect 16 0 17 0;
#X restore 765 43 pd Hann-window;
#N canvas 0 22 458 308 syncsignal 0;
#X obj 24 8 loadbang;
#X obj 42 57 bng 15 250 50 0 empty empty empty 0 -6 0 8 -262144 -1
-1;
#X obj 78 85 samplerate~;
#X msg 200 87 0;
#X obj 79 110 / 512;
#X obj 77 135 phasor~;
#X obj 81 169 *~ 512;
#X obj 80 226 tabwrite~ \$0-sync;
#N canvas 0 22 450 300 graph2 0;
#X array \$0-sync 512 float 2;
#X coords 0 512 511 0 200 140 1;
#X restore 241 51 graph;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 0 3 0;
#X connect 1 0 7 0;
#X connect 2 0 4 0;
#X connect 3 0 5 1;
#X connect 4 0 5 0;
#X connect 5 0 6 0;
#X connect 6 0 7 0;
#X restore 765 62 pd syncsignal;
#X obj 517 111 inlet~;
#X obj 373 273 outlet~;
#N canvas 0 22 458 308 presets 0;
#X obj 103 20 loadbang;
#X obj 93 152 s \$0-attackbins_r;
#X obj 90 179 s \$0-releasebins_r;
#X obj 103 261 s \$0-maxamp_r;
#X obj 111 208 s \$0-tilt_r;
#X obj 97 236 s \$0-thrshld_r;
#X obj 218 248 s \$0-minamp_r;
#X msg 65 57 0;
#X msg 101 57 0.5;
#X msg 25 56 1;
#X msg 154 56 20;
#X connect 0 0 9 0;
#X connect 0 0 7 0;
#X connect 0 0 8 0;
#X connect 0 0 10 0;
#X connect 7 0 6 0;
#X connect 8 0 4 0;
#X connect 8 0 5 0;
#X connect 9 0 3 0;
#X connect 10 0 1 0;
#X connect 10 0 2 0;
#X restore 686 154 pd presets;
#X obj 100 100 cnv 15 170 151 empty empty empty 20 12 0 14 -259234
-66577 0;
#X obj 110 107 cnv 15 150 50 empty empty empty 20 12 0 14 -212941 -66577
0;
#X obj 117 172 knob 30 30 0 1 0 0 \$0-tilt \$0-tilt_r tilt 5 -6 32
8 -1 -1 -1 1450 1;
#X obj 153 179 nbx 5 14 -1e+37 1e+37 0 0 \$0-maxamp \$0-maxamp_r max.amp
58 6 0 10 -187840 -1 -1 1 256;
#X obj 153 196 nbx 5 14 -1e+37 1e+37 0 0 \$0-minamp \$0-minamp_r min.amp
58 6 0 10 -187840 -1 -1 0 256;
#N canvas 0 22 450 300 graph2 0;
#X array \$0-tiltray 512 float 2;
#X coords 0 127 255 0 150 50 1;
#X restore 110 107 graph;
#X obj 153 162 nbx 5 14 0 1 0 0 \$0-thrshld \$0-thrshld_r thrshld 57
6 0 10 -187840 -1 -1 0.5 256;
#X obj 153 213 nbx 5 14 -1e+37 1e+37 0 0 \$0-attackbins \$0-attackbins_r
attack 58 6 0 10 -261391 -1 -1 20 256;
#X obj 153 230 nbx 5 14 -1e+37 1e+37 0 0 \$0-releasebins \$0-releasebins_r
release 58 6 0 10 -261391 -1 -1 20 256;
#X connect 1 0 5 0;
#X connect 4 0 1 0;
#X coords 0 -1 1 1 170 151 1 100 100;
